<!doctype html><html lang=en><head><title>Fallback - Ethernaut :: DimitrisV SV1SJP</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="We have the smart-contract Fallback and we are requested to claim the ownership of the contract, and then reduce it&amp;rsquo;s balance to 0. At first, let&amp;rsquo;s read the smart contract&amp;rsquo;s code and search if something interesting is going on there:
// SPDX-License-Identifier: MIT pragma solidity ^0.6.0; import &amp;#39;@openzeppelin/contracts/math/SafeMath.sol&amp;#39;; contract Fallback { using SafeMath for uint256; mapping(address =&amp;gt; uint) public contributions; address payable public owner; constructor() public { owner = msg.sender; contributions[msg."><meta name=keywords content="linux"><meta name=robots content="noodp"><link rel=canonical href=/blockchain_writeups/fallback/><link rel=stylesheet href=/assets/style.css><link rel=stylesheet href=/assets/pink.css><link rel=apple-touch-icon href=/img/apple-touch-icon-192x192.png><link rel="shortcut icon" href=/favicon.ico><meta name=twitter:card content="summary"><meta name=twitter:site content><meta name=twitter:creator content="DimitrisV"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="Fallback - Ethernaut"><meta property="og:description" content="We have the smart-contract Fallback and we are requested to claim the ownership of the contract, and then reduce it&amp;rsquo;s balance to 0. At first, let&amp;rsquo;s read the smart contract&amp;rsquo;s code and search if something interesting is going on there:
// SPDX-License-Identifier: MIT pragma solidity ^0.6.0; import &amp;#39;@openzeppelin/contracts/math/SafeMath.sol&amp;#39;; contract Fallback { using SafeMath for uint256; mapping(address =&amp;gt; uint) public contributions; address payable public owner; constructor() public { owner = msg.sender; contributions[msg."><meta property="og:url" content="/blockchain_writeups/fallback/"><meta property="og:site_name" content="DimitrisV SV1SJP"><meta property="og:image" content="/favicon.ico"><meta property="og:image:width" content="2048"><meta property="og:image:height" content="1024"><meta property="article:published_time" content="2021-12-19 00:00:00 +0000 UTC"></head><body class=pink><div class="container center headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>DimitrisV SV1SJP</div></a></div><div class=menu-trigger>menu</div></div><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=/about.html>About</a></li><li><a href=/blockchain_camera>Blockchain Camera</a></li><li><a href=/blockchain_writeups>Blockchain WriteUps</a></li><li><a href=/panellinies_aepp/index.html>Panellinies_AEPP</a></li><li><a href=/projects>Projects</a></li><li><a href=/ubuntel>Ubuntel</a></li></ul><ul class="menu__inner menu__inner--mobile"><li><a href=/about.html>About</a></li><li><a href=/blockchain_camera>Blockchain Camera</a></li><li><a href=/blockchain_writeups>Blockchain WriteUps</a></li><li><a href=/panellinies_aepp/index.html>Panellinies_AEPP</a></li><li><a href=/projects>Projects</a></li><li><a href=/ubuntel>Ubuntel</a></li></ul></nav></header><div class=content><div class=post><h1 class=post-title><a href=/blockchain_writeups/fallback/>Fallback - Ethernaut</a></h1><div class=post-meta><span class=post-date>2021-12-19</span>
<span class=post-author>:: DimitrisV</span></div><div class=post-content><div><p>We have the smart-contract Fallback and we are requested to claim the ownership of the contract, and then reduce it&rsquo;s balance to 0.
At first, let&rsquo;s read the smart contract&rsquo;s code and search if something interesting is going on there:</p><pre tabindex=0><code>// SPDX-License-Identifier: MIT
pragma solidity ^0.6.0;

import &#39;@openzeppelin/contracts/math/SafeMath.sol&#39;;

contract Fallback {

  using SafeMath for uint256;
  mapping(address =&gt; uint) public contributions;
  address payable public owner;

  constructor() public {
    owner = msg.sender;
    contributions[msg.sender] = 1000 * (1 ether);
  }

  modifier onlyOwner {
        require(
            msg.sender == owner,
            &#34;caller is not the owner&#34;
        );
        _;
    }

  function contribute() public payable {
    require(msg.value &lt; 0.001 ether);
    contributions[msg.sender] += msg.value;
    if(contributions[msg.sender] &gt; contributions[owner]) {
      owner = msg.sender;
    }
  }

  function getContribution() public view returns (uint) {
    return contributions[msg.sender];
  }

  function withdraw() public onlyOwner {
    owner.transfer(address(this).balance);
  }

  receive() external payable {
    require(msg.value &gt; 0 &amp;&amp; contributions[msg.sender] &gt; 0);
    owner = msg.sender;
  }
}
</code></pre><p>First of all, let&rsquo;s talk about the constructor. Constructor is an optional function and is used to initialize state variables of a contract. State variables are variables whose values are permanently stored in smart-contract&rsquo;s storage. We have to mention here that each contract can have only one constructor. A constructor code is executed once when a contract is created and it is used to initialize contract state. After a constructor code executed, the final code is deployed to blockchain. Taking this into account, under the deployment of the smart-contract, the constructor runs at first and sets the person who deployed the smart-contract as an owner in the public Boolean variable &ldquo;owner&rdquo;, by the command:</p><pre tabindex=0><code>owner = msg.sender;
</code></pre><p>If we type in console:</p><pre tabindex=0><code>await contract.owner()
</code></pre><p>We can see the address that deployed this smart contract and by typing:</p><pre tabindex=0><code>contract.address
</code></pre><p>We can find the smart-contract&rsquo;s address. Each user and each smart-contract in Ethereum Blockchain has it&rsquo;s own address. If we type &ldquo;player&rdquo; we can find our wallet&rsquo;s address.
So, to begin with, as we want to claim ownership of the smart-contract, we are trying to find out something that sets us as the owner. We can see that there is a receive() external function that if we pass it&rsquo;s requirements, it sets us as the owner of the smart-contract. It looks interesting. From Solidity&rsquo;s documentation, we can find out that receive() is a fallback function that is executed when we create general transactions, without calling a specific function from the contract. The receive() function is executed on a call to the contract with empty calldata. This type of functions cannot have arguments or return anything. We keep this in our minds for now.
The second requirements wants for us to be in the contributions array and having us sent an amount of ether more than 0. We check the contributions array if we are inside on it by calling:</p><pre tabindex=0><code>await contract.contributions(player)
</code></pre><p>However, it returns as false. So, let&rsquo;s check the code again to find a way to add ourselves in &ldquo;contributions&rdquo;. We can see that a payable function exists and requires to get an amount of ether smaller than 0.01 ether. We can simply send 1 Wei, the smallest amount of ether that we can send to someone by typing in console:</p><pre tabindex=0><code>contract.contribute({value:1})
</code></pre><p>So now we added ourselves in the &ldquo;contributions&rdquo; array. Now we pass the one requirement. It&rsquo;s time to send a small amount of money (1 Wei as the requirement needs to be more than 0) in a generic transaction in order to pass the second requirement in the receive() function and trigger it. We type:</p><pre tabindex=0><code>contract.sendTransaction({value:1})
</code></pre><p>After all of this, we can check again who is the owner of the smart-contract and we can see our address on this variable. We successfully own the smart-contract now. Let&rsquo;s reduce it&rsquo;s balance to zero.
The &ldquo;withdraw&rdquo; function can help us with that which can be executed only from the owner of the contract. But now we are the owner. It&rsquo;s time to withdraw all of it&rsquo;s ether. We type in console:</p><pre tabindex=0><code>contract.withdraw()
</code></pre><p>And then, let&rsquo;s check the balance of the smart-contract:</p><pre tabindex=0><code>await getBalance(contract.address)
</code></pre><p>We will see a balance of 0 on this smart-contract.That means that we successfully withdrawn all of it&rsquo;s ether. We successfully won this game!!!</p><hr><p>If you want to learn more about Smart Contract Security, please check our paper and eCourses:</p><h2 id=smart-contract-security>Smart-Contract Security:<a href=#smart-contract-security class=hanchor arialabel=Anchor>&#8983;</a></h2><ul><li><a href=https://github.com/sv1sjp/eVoting_Elections_Decentralized_App/blob/main/smartcontract_security_paper.pdf>Smart Contract Security: Dimitris Vagiakakakos, Stavros Gkinos, Ioannis Karvelas</a></li></ul><ul><li><a href="https://www.youtube.com/playlist?list=PLZa7COjIxKWzLcMxI9cRNSzOtdR0xvXB7">Smart Contract Security - Educational YouTube Series in Greek - Click Here</a></li></ul></div></div></div></div><footer class=footer><div class=footer__inner><div class="copyright copyright--user"><span>Dimitris LinuxOS - TuxHouse - 2011-2023</span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><script src=/assets/main.js></script>
<script src=/assets/prism.js></script>
<script src=/assets/languageSelector.js></script></div></body></html>